version: '3.8'

# Portainer: (1) Standalone: "Load variables from .env file" â†’ stack.env is used via env_file.
# (2) Swarm: env_file is ignored. Either set MASTODON_ACCESS_TOKEN in the stack's
#     Environment variables (key-value), or create a secret and mount it: add under
#     "secrets:" a secret "mastodon_access_token" (external, value = token only) and
#     under bot service add "secrets: [mastodon_access_token]". The app reads it from
#     /run/secrets/mastodon_access_token. Local: cp .env stack.env (stack.env in .gitignore).
services:
  bot:
    build: .
    container_name: saiugol-bot
    restart: unless-stopped
    env_file:
      - stack.env
    environment:
      - MASTODON_INSTANCE=${MASTODON_INSTANCE:-https://mastodon.social}
      - POLL_INTERVAL_MS=${POLL_INTERVAL_MS:-60000}
      - DRY_RUN=${DRY_RUN:-false}
      - DELAY_BETWEEN_POSTS_MS=${DELAY_BETWEEN_POSTS_MS:-2000}
      - DELAY_BETWEEN_THREAD_POSTS_MS=${DELAY_BETWEEN_THREAD_POSTS_MS:-1000}
      - DELAY_BEFORE_HIGHLIGHTS_MS=${DELAY_BEFORE_HIGHLIGHTS_MS:-30000}
      - STATE_SAVE_INTERVAL_MS=${STATE_SAVE_INTERVAL_MS:-300000}
      - RETRY_MAX_ATTEMPTS=${RETRY_MAX_ATTEMPTS:-3}
      - RETRY_INITIAL_DELAY_MS=${RETRY_INITIAL_DELAY_MS:-1000}
      - RETRY_MAX_DELAY_MS=${RETRY_MAX_DELAY_MS:-10000}
    volumes:
      - saiugol-data:/app/data

volumes:
  saiugol-data:
