version: '3.8'

# Portainer (deploy from Git): set variables in the stack's "Environment variables" (Add stack
# or Edit stack). See https://docs.portainer.io/user/docker/stacks/add#environment-variables
# Using only "environment:" (no env_file) avoids "stack.env not found" when deploying from Git.
# Optional: you can use env_file: stack.env if you define vars in Portainer (individually or
# "Load variables from .env file"); Portainer creates stack.env. Swarm: env_file is not supported.
# Local: create .env; Compose uses it for ${VAR} substitution.
services:
  bot:
    build: .
    container_name: saiugol-bot
    restart: unless-stopped
    environment:
      - MASTODON_ACCESS_TOKEN=${MASTODON_ACCESS_TOKEN}
      - MASTODON_INSTANCE=${MASTODON_INSTANCE:-https://mastodon.social}
      - POLL_INTERVAL_MS=${POLL_INTERVAL_MS:-60000}
      - DRY_RUN=${DRY_RUN:-false}
      - DELAY_BETWEEN_POSTS_MS=${DELAY_BETWEEN_POSTS_MS:-2000}
      - DELAY_BETWEEN_THREAD_POSTS_MS=${DELAY_BETWEEN_THREAD_POSTS_MS:-1000}
      - DELAY_BEFORE_HIGHLIGHTS_MS=${DELAY_BEFORE_HIGHLIGHTS_MS:-30000}
      - STATE_SAVE_INTERVAL_MS=${STATE_SAVE_INTERVAL_MS:-300000}
      - RETRY_MAX_ATTEMPTS=${RETRY_MAX_ATTEMPTS:-3}
      - RETRY_INITIAL_DELAY_MS=${RETRY_INITIAL_DELAY_MS:-1000}
      - RETRY_MAX_DELAY_MS=${RETRY_MAX_DELAY_MS:-10000}
    volumes:
      - saiugol-data:/app/data

volumes:
  saiugol-data:
